[null,{"name":"NovoMembro","permissions":"ADMINISTRATOR","restriction":"1","_id":"JaPra","actions":[{"info":"0","find":"691759397902483570","storage":"1","varName":"chat-principal","name":"Find Channel"},{"url":"https://s7.gifyu.com/images/drime-boas-vindas.jpg","storage":"1","varName":"fundojpg","name":"Create Image"},{"member":"2","varName":"membro","storage":"1","varName2":"img-avatar","name":"Create Image from Avatar"},{"storage":"1","varName":"img-avatar","width":"245","height":"245","name":"Resize Image"},{"storage":"1","varName":"fundojpg","storage2":"1","varName2":"img-avatar","x":"48","y":"44","mask":"0","name":"Draw Image on Image"},{"member":"2","varName":"membro","info":"18","storage":"1","varName2":"user-tag","name":"Store Member Info"},{"storage":"1","varName":"fundojpg","x":"332","y":"150","font":"fonts/Asimov.fnt","width":"","text":"${tempVars(\"user-tag\")}","name":"Draw Text on Image"},{"storage":"1","varName":"fundojpg","channel":"5","varName2":"chat-principal","message":"Novo membro! ðŸŽ‰\n```\nUtilize o comando \"!comandos\" para usar reaÃ§Ãµes no servidor.```","name":"Send Image"}],"event-type":"6","temp":"membro"},{"name":"SaiuMembro","temp":"membro-saiu","event-type":"7","_id":"DdbaQ","actions":[{"member":"2","varName":"membro-saiu","info":"1","storage":"1","varName2":"chat-membro","name":"Store Member Info"},{"member":"2","varName":"membro-saiu","info":"1","varName2":"","iftrue":"1","iftrueVal":"","iffalse":"0","iffalseVal":"","name":"Check If Member"},{"channel":"5","varName":"chat-membro","message":"Ã‰ uma pena que vocÃª tenha saÃ­do. ðŸ’”\n\nEstamos fazendo o melhor para que o servidor seja um lugar divertido, mas vejo que nÃ£o foi o bastante. \nNos empenharemos mais para evitar que isso aconteÃ§a.\n\nCaso queira voltar, este Ã© o link:\n\nhttps://discord.gg/9zwrR75","storage":"0","varName2":"","iffalse":"0","iffalseVal":"","name":"Send Message"}]},{"name":"sorteioStart","temp":"","event-type":"1","_id":"jEKcf","actions":[{"behavior":"0","interpretation":"0","code":"const fs = require('fs');\n\nif (globalVars(\"giveawayStartRan\") == null) {\n    this.storeValue(1, 3, \"giveawayStartRan\", cache);\n    if (!fs.existsSync('./data/giveawayData.json')) {\n        fs.writeFile(\"./data/giveawayData.json\", \"{}\", function(err) {\n            if (err) {\n                return console.log(err);\n            }\n        });\n    }\n}","storage":"0","varName":"","name":"Run Script"}]},{"name":"sorteioCheck","temp":"10","event-type":"3","_id":"eavvT","actions":[{"behavior":"0","interpretation":"1","code":"const fs = require('fs');\nconst Discord = require('discord.js');\nlet giveawaysDue = [];\nvar timeNow = Math.floor(Date.now() / 1000);\nvar counter = 0;\nvar interval;\nif (globalVars(\"giveawayRan\") == null) {\n    this.storeValue(1,3,\"giveawayRan\",cache);\n\n    fs.readFile('./data/giveawayData.json', async function read(err, data) {\n        if (err) {\n            throw err;\n        }\n        data = JSON.parse(data);\n    \n        for (var key in data) {\n            if (data.hasOwnProperty(key)) {\n                let giveaways = data[key];\n                let dueGive = await giveaways.filter(({\n                    finishUnix\n                }) => finishUnix <= timeNow);\n                if (dueGive.length > 0) {\n                    dueGive.forEach(async f => {\n                        giveawaysDue.push(f);\n                        giveaways.splice(giveaways.findIndex(e => e.id === f.id), 1)\n                    });\n    \n                    fs.writeFile(\"./data/giveawayData.json\", JSON.stringify(data), function(err) {\n                        if (err) {\n                            return console.log(err);\n                        }\n                    });\n                }\n            }\n        }\n        if (giveawaysDue.length > 0) {\n            interval = setInterval(drawWinners, 2000);\n        }\n        \n    })\n}\n\nasync function drawWinners() {\n        var channelToFetch = await client.channels.get(giveawaysDue[counter][\"channel\"]);\n        if (channelToFetch != null) {\n            var giveawayMessage = await channelToFetch.fetchMessage(giveawaysDue[counter][\"giveawayMessageID\"]);\n            var giveawayUsers = await giveawayMessage.reactions.get('ðŸŽ‰').fetchUsers();\n            giveawayUsers = giveawayUsers.array();\n            giveawayUsers = await giveawayUsers.filter(object => object.id != client.user.id);\n            var numberOfWinners = parseInt(giveawaysDue[counter][\"winner\"]);\n            var gw = giveawayMessage.embeds[0];\n\n            var giveawayEmbed = new Discord.RichEmbed({\n                color: 0x000000,\n                author: {\n                    name: 'ðŸŽ‰ Sorteio Finalizado ðŸŽ‰',\n                    icon_url: (client || this.getDBM().Bot.bot).user.avatarURL\n                },\n                description: gw.description,\n                footer: {\n                    text: gw.footer.text\n                }\n            })\n            var winnerArray = [];\n            var winnerText = \"\";\n            if (giveawayUsers.length > 0) {\n                if (giveawayUsers.length > numberOfWinners) {\n                    for (var i = 0; i < numberOfWinners; i++) {\n                        var randomNumber = Math.floor(Math.random() * giveawayUsers.length);\n                        var randomuser = giveawayUsers[randomNumber];\n                        winnerArray.push(randomuser);\n                        giveawayUsers.splice(giveawayUsers.indexOf(randomNumber), randomNumber);\n                    }\n                } else if (giveawayUsers.length <= numberOfWinners) {\n                    for (i = 0; i < giveawayUsers.length; i++) {\n                        winnerArray.push(giveawayUsers[i]);\n                    }\n                }\n\n                for (i = 0; i < winnerArray.length; i++) {\n                    winnerText = winnerText + winnerArray[i] + '\\n';\n                }\n\n                giveawayEmbed.description = giveawayEmbed.description + `\\n\\nOs vencedrores sÃ£o..\\n${winnerText}`;\n                giveawayMessage.edit(giveawayEmbed)\n                channelToFetch.send(`ðŸŽ‰ ParabÃ©ns! ðŸŽ‰ \\n ${winnerText} \\n Eles ganharam **${giveawaysDue[counter][\"itemGivingAway\"]}**`)\n\n            } else {\n                giveawayEmbed.description = giveawayEmbed.description + \"\\n\\nNinguÃ©m entrou no sorteio e, portanto, ninguÃ©m ganhou.\"\n                giveawayMessage.edit(giveawayEmbed);\n                channelToFetch.send(`ðŸŽ‰ Sorteio Finalizado ðŸŽ‰\\n\\nNinguÃ©m entrou no sorteio e, portanto, ninguÃ©m ganhou.`)\n            }\n        }\n        counter += 1;\n        if (counter >= giveawaysDue.length) {\n            clearInterval(interval);\n        }\n    }","storage":"0","varName":"","name":"Run Script"},{"time":"7","measurement":"1","name":"Wait"},{"storage":"3","varName":"giveawayRan","changeType":"0","value":"null","name":"Control Variable"}],"temp2":"America/New_York"}]
